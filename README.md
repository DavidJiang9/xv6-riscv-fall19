# Lab-alloc

主要有两个任务：
1. 修改`kernel/file.c`， 创建文件时使用`buddy allocator`申请空间
2. 修改`kernel/buddy.c`，用xor运算减少记录每一层的分配和分裂信息的位向量

## Task I

原本的文件表是真正的列表，只有100的容量，也就是整个系统最多能支持打开100个文件。用refcount是否为0来表示该表项是否可用
> 文件表是全局表，项被文件描述符所指，项内容有指向inode的指针，包含offset，包含refcount  
> 每个进程持有的，是打开的文件描述符表，记录文件表项指针。


现在目的是去掉全局的文件列表，用动态分配的方式提供文件表项，在refcount为0时就回收内存。

`filealloc`时，`malloc`应该和`ref`的设置在锁中进行，保证创建中间不会插入`dup`之类的操作。

本来`fileclose`中的`ff`的作用是减少锁的作用范围。如果`ref`为0，重置必要信息后就释放锁，让当前的文件表项可以立即被重用。剩下的资源释放工作，基于复制到本地栈上的`ff`信息，慢慢清理。改动后使用动态内存分配，重用的压力没有那么大，所以不需要用`ff`复制。

## Task II

